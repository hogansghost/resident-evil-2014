function randomise(e,t){var n=Math.floor(Math.random()*(e-t+1))+t;return n}function init(){var e=eventtouch&&window.innerWidth<=900?1:0,t=[["css/img/background-sprite.jpg","css/img/table.png","css/img/enemy-sprite.png","css/img/misc-sprite.png","css/img/damage.png","css/img/firearm-effects.png","css/img/portrait-bg.png"],["css/img/mob/mbackground-sprite.jpg","css/img/mob/mmisc-sprite.png","css/img/mob/mtable.png","css/img/mob/menemy-sprite.png","css/img/mob/mfirearm-effects.png","css/img/mob/mdamage.png","css/img/portrait-bg.png"]];var n=t[e].length;var r=0,i=0;var s=function(){if(r+i==n){console.log("All images loaded.");$(".slide").swipeCarousel();screenShow("start");$(".loading").hide()}};var o=function(n){r++;if(n.currentTarget.attributes.src.value==t[e][0]){backgroundRatio(n.currentTarget.width,n.currentTarget.width/2)}s()},u=function(){i++;s()};for(var a=0;a<n;a++){var f=new Image;f.src=t[e][a];f.onload=o;f.onerror=u;f=null}}function screenShow(e){if(e===undefined)return;$('.screen[data-screen-name="'+e+'"]').show();pauseGame()}function screenHide(e){if(e===undefined){$(".screen").hide()}else{$('.screen[data-screen-name="'+e+'"]').hide()}unpauseGame()}function startGame(){screenHide();beginInterval();if(gameover==true){scoreReset();gameover=false}if(sounds==true){playAudio(trackListing.misc.background);audioFadeIn(trackListing.misc.background);trackListing.misc.background.loop=true}}function unpauseGame(){setTimeout(function(){if(!gameover){pause=false}},500)}function pauseGame(){if(!gameover){pause=true}}function loop(){loopStatus=true;var e=randomise(450,1200);setTimeout(function(){if(!gameover&&loopStatus){enemyCreate();loop()}},randomise(450,1200))}function beginInterval(){if(!loopStatus)loop();window.globalCounter=setInterval(function(){if(pause)return;$(".interval").html(p++);if(pause==true){clearInterval(globalCounter);return}for(var e=0;e<enemies.length;e++){if(enemies[e].attack<=0){for(var t=0;t<enemies.length;t++){if(enemies[e].uid==enemies[t].uid){$(".bite").show();player.health=player.health-damageVariation(damageTable[enemies[t].type].attackDamage);enemies[t].attack=damageTable[enemies[t].type].attackTime;setTimeout(function(){$(".bite").hide()},500)}}}else{for(var t=0;t<enemies.length;t++){if(enemies[e].uid==enemies[t].uid){enemies[e].attack=enemies[t].attack-20}}}}playerHealthCheck();for(var e=0;e<enemies.length;e++){var n=enemies[e].attack/damageTable.zombie.attackTime*100;offset=n/2;var r=enemies[e].uid;$('.enemy[data-uid="'+r+'"]').find(".attack-bar").css({width:n+"%","margin-left":"-"+offset+"%"})}},20)}function gameOver(){gameover=true;loopStatus=false;$(trackListing.misc.background).animate({volume:0},250);playAudio(trackListing.misc.gameover);clearTimeout(window.globalCounter);$(".screen-gameover .score-main").html('<h1 style="font-size:35px;color:#fff;">Score: '+player.score.total+"</h1>"+'<h1 style="font-size:35px;color:#fff;">Accuracy: '+(player.shots.total<=0?0:(player.shots.total-player.shots.miss)/player.shots.total*100).toFixed(2)+"%</h1>");$(".screen-gameover .score-detail").html("<div>Head: "+player.shots.head+"</div>"+"<div>Body: "+player.shots.body+"</div>"+"<div>Leg: "+player.shots.leg+"</div>"+"<div>Arm: "+player.shots.arm+"</div>");$(".screen-gameover").fadeIn(500,function(){gameReset()});$(window).trigger("resize")}function gameReset(){$(".player-message").hide();$(".health-item").remove();$(".enemy").remove();enemies=[];magazine=magazineMax;$(".shots .magazine").css({left:0});player.health=player.maxHealth}function playerHealthCheck(){if(player.health<=1e3){$("body").data("health","danger");$(".health").removeClass("caution").addClass("danger");$("body").removeClass("caution").addClass("danger")}else if(player.health<=5e3){$(".health").removeClass("danger").addClass("caution");$("body").removeClass("danger").addClass("caution")}else{$(".health").removeClass("caution danger");$("body").removeClass("caution danger")}if(player.health<=0||gameover==true){gameOver()}}function reloadEvent(e){if(e!==undefined&&e.type==eventstart)e.preventDefault();if(pause==true)return;if(e.keyCode==67){cheat()}if((e.keyCode==82||e.type==eventstart)&&reloading==false){reloading=true;playAudio(trackListing.firearm.reload);$(".player-message").html("RELOADING...").fadeIn(0);$(".reload-button").removeClass("reload");$(".shots .magazine").animate({left:0},750,"linear",function(){magazine=magazineMax;reloading=false;$(".player-message").hide();$(".firearm").removeClass("empty")});return;var t=(12-$(".bulletcount-bullet").length)*150;var n=setInterval(function(){if($(".bulletcount-bullet").length>=12)return;$(".shots").append('<span class="bulletcount-bullet"></span>');magazine++},150);setTimeout(function(){reloading=false;clearInterval(n);$(".player-message").hide()},t+50)}}function reloadEnd(){reloading=false;clearInterval(bulletInsert);$(".player-message").hide()}function reloadPrompt(){if(reloading==false){$(".player-message").html("Reload!").fadeIn(0);$(".reload-button").addClass("reload")}}function playAudio(e){if(e===undefined||sounds==false)return;if(e.paused==false){e.pause();e.currentTime=0;e.play()}else{e.play()}}function audioControls(e){if(e!==undefined)e.preventDefault();if(sounds==false){audioOn();$(".audio").html("mute")}else{audioOff();$(".audio").html("unmute")}}function audioOff(){sounds=false;$(trackListing.misc.background).stop(true,true).animate({volume:0},1e3)}function audioOn(){sounds=true;if(gameover!==true){trackListing.misc.background.volume=0;trackListing.misc.background.play();$(trackListing.misc.background).stop(true,true).animate({volume:1},1e3)}}function audioFadeOut(e){if(e===undefined)return;$(e).stop(true,true).animate({volume:0},1e3)}function audioFadeIn(e){if(e===undefined)return;e.volume=0;e.play();$(e).stop(true,true).animate({volume:1},1e3)}function enemyType(){var e,t=[["enemy01","zombie"],["enemy02","zombie"],["enemy03","zombie"],["enemy04","crimson"],["enemy05","hunter"]];if(player.score.kills>=60){enemyMaxCount=eventtouch?4:6;e=randomise(4,0)}else if(player.score.kills>=20){enemyMaxCount=eventtouch?3:5;e=randomise(3,0)}else{enemyMaxCount=eventtouch?2:4;e=randomise(2,0)}return[t[e][0],t[e][1]]}function cheat(){player.health=1e10;magazine=1e3}function enemyCreate(){if(gameover||pause)return;var e=$(".target-area").outerHeight(true)-200;var t=$(".target-area").outerWidth(true)-150;var n=Math.floor(Math.random()*(t-30+1))+30;var r="30%";var i=1;if(document.querySelectorAll(".target-area .enemy").length>=enemyMaxCount)return;var s,o=n/window.innerWidth*100;if(o>10&&o<20){r=damageVariation(16)+"%";n=n/window.innerWidth*100+"%";i=".66";s=2}else if(o>=20&&o<35){r=damageVariation(8)+"%";n=n/window.innerWidth*100+"%";i=".55";s=0}else if(o>=35&&o<40){r=damageVariation(9)+"%";n=n/window.innerWidth*100+"%";i=".60";s=0}else if(o>=30&&o<45){r=damageVariation(11)+"%";n=n/window.innerWidth*100+"%";i=".65";s=0}else if(o>=45&&o<55){r=damageVariation(16)+"%";n=n/window.innerWidth*100+"%";i=".65";s=1}else if(o>=55&&o<65){r=damageVariation(19)+"%";n=n/window.innerWidth*100+"%";i=".75";s=2}else{n=n/window.innerWidth*100+"%";s=3}var u=enemyType();var a=["enemyStagger01","enemyStagger02","enemyStagger03","enemyStagger04"];var f=$('<div class="enemy '+u[0]+'" data-uid="'+uid+'" data-type="'+u[1]+'" style="color:#fff;font-weight:bold;top:'+r+"; left:"+n+"; z-index:"+s+";transform:scale("+i+") translate3d(0,0,0);-webkit-transform:scale("+i+') translate3d(0,0,0);">'+'<span class="attack-bar"></span>'+'<span class="hitbox head" data-event="head"></span>'+'<span class="hitbox body" data-event="body"></span>'+'<span class="hitbox arm left" data-event="arm"></span>'+'<span class="hitbox arm right" data-event="arm"></span>'+'<span class="hitbox leg left" data-event="leg"></span>'+'<span class="hitbox leg right" data-event="leg"></span>'+"</div>");uid++;enemies.push({uid:f.attr("data-uid"),type:f.attr("data-type"),health:damageVariation(damageTable[u[1]].health),attack:damageTable[u[1]].attackTime});$(".target-area").prepend(f)}function damageVariation(e){var t=e-e/100*randomise(6,1),n=e+e/100*randomise(6,1);return Math.floor(randomise(n,t))}function targetHit(e){if(e===undefined)return;var t=$(e).closest(".enemy"),n=t.data("type");if($(e).hasClass("body")){targetUpdateEnemies(t,damageVariation(damageTable[n].body),"body");return}else if($(e).hasClass("head")){targetUpdateEnemies(t,damageVariation(damageTable[n].head),"head");return}else if($(e).hasClass("arm")){targetUpdateEnemies(t,damageVariation(damageTable[n].arm),"arm");return}else if($(e).hasClass("leg")){targetUpdateEnemies(t,damageVariation(damageTable[n].leg),"leg");return}}function targetUpdateEnemies(e,t,n){var r,i=enemies.length;for(var s=0;s<i;s++){if(enemies[s].uid==e.data("uid")){r=enemies[s];enemies[s].health=enemies[s].health-t;enemies[s].attack=enemies[s].attack>=damageTable[e.data("type")].attackTime?damageTable[e.data("type")].attackTime:enemies[s].attack+50;break}}targetCheckHealth(enemies[s],n)}function targetCheckHealth(e,t){if(t=="head"&&e.health<=0){scoreUpdate(damageTable.score.headKill,t)}else if(t=="head"){scoreUpdate(damageTable.score[t],t)}else if(t=="body"){scoreUpdate(damageTable.score[t],t)}else if(t=="arm"){scoreUpdate(damageTable.score[t],t)}else if(t=="leg"){scoreUpdate(damageTable.score[t],t)}if(e.health<=0){enemyRemove(e);killsUpdate()}}function enemyRemove(e){if(e===undefined)return;var t=$('[data-uid="'+e.uid+'"]');t.find(".hitbox").remove();enemies.splice(enemies.indexOf(e),1);eventPercent(5,function(){healthItemCheck(t)});if(!eventtouch){t.fadeOut(250,function(){$(this).remove()})}else{t.remove()}}function killsUpdate(){player.score.kills++}function scoreUpdate(e,t){player.score.total+=e;player.shots[t]+=1}function scoreReset(){for(var e in player.score){if(player.score.hasOwnProperty(e)){player.score[e]=0}}for(var e in player.shots){if(player.shots.hasOwnProperty(e)){player.shots[e]=0}}}function eventPercent(e,t){if(e===undefined||t===undefined)return;var n=randomise(100,0);if(n>0&&n<=e){t()}}function healthItemCheck(e){var t=$('<div class="health-item" data-event="body"></div>').css({top:n,left:r}),n=randomise(62,57)+"%",r=randomise(75,20)+"%";if(e.data("type")=="zombie"){t=$('<div class="health-item"></div>').data("event","herb").css({top:n,left:r})}else{t=$('<div class="health-item health-mixed"></div>').data("event","herbMixed").css({top:n,left:r})}$(".target-area").append(t)}function healthItemEvent(e,t){if(t===undefined){if(e.data("event")=="herb")t=600;else t=1050}var n=player.health,r=player.health+t;if(r>=player.maxHealth){player.health=player.maxHealth}else{player.health=r}playAudio(trackListing.misc.healing);$(e).remove()}function playerHealth(e,t){var n=player.health}function pageRatioRemove(){$(".game-container").css({width:"auto",height:"auto"});$(window).off("resize",pageRatio)}function pageRatio(){$(".game-container").css({width:window.innerWidth,height:window.innerHeight})}function backgroundRatio(e,t){if(e===undefined){e=backgroundWidth;t=backgroundHeight}else if(e==0){e=1280;t=720}else if(e!==undefined&&t!==undefined){backgroundWidth=e;backgroundHeight=t}e=1280;t=720;var n=[window.innerWidth/e,window.innerHeight/t];n=Math.min(n[0],n[1]);$(".target-area").css({width:Math.floor(e*n)+"px",height:Math.floor(t*n)+"px",margin:"0 auto"});if(eventtouch){$("body").addClass("touch-check").removeClass("click-check")}else{$("body").removeClass("touch-check").addClass("click-check")}}function getImageSize(e){var t=new Image;t.src=e;backgroundWidth=t.width;backgroundHeight=t.height}function orientationChange(){if(window.innerHeight>window.innerWidth){$(".portrait").show();if(!gameover){pauseGame()}}else{$(".portrait").hide();if(!gameover){unpauseGame()}}}function preloadGraphics(){var e=eventtouch?1:0,t=[["css/img/enemy-sprite.png","css/img/firearm-effects.png"],["css/img/mob/enemy-sprite.png"]];for(var n=0;n<t[e].length;n++){var r=new Image;r.src=t[e][n]}}function get_location(){navigator.geolocation.getCurrentPosition(show_map);alert(location.coords.latitude);alert(location.coords.longitude);alert(location.coords.accuracy)}function getLocation(){$("body").append('<div class="coords" style="position:fixed;top:0;left:0;height:10px;width:10px;z-index:10000000000;background:rgba(25,255,25,.3)"></div>');if(navigator.geolocation){navigator.geolocation.getCurrentPosition(showPosition,showError)}else{alert("Geolocation is not supported by this browser.")}}function showPosition(e){$(".coords").css({background:"rgba(255,25,25,.3)"});alert("Lat: "+e.coords.latitude+", Log: "+e.coords.longitude+", Accuracy: "+e.coords.accuracy)}function showError(e){var t;switch(e.code){case e.PERMISSION_DENIED:t="User denied the request for Geolocation.";break;case e.POSITION_UNAVAILABLE:t="Location information is unavailable.";break;case e.TIMEOUT:t="The request to get user location timed out.";break;case e.UNKNOWN_ERROR:t="An unknown error occurred.";break}alert(t)}var eventtouch="ontouchstart"in document.documentElement?true:true,eventclick=eventtouch?"tap":"click",eventstart=eventtouch?"touchstart":"mousedown",eventend=eventtouch?"touchend":"mouseup",eventmove=eventtouch?"touchmove":"mousemove";var trackListing={firearm:{shot:eventtouch?"":new Audio("sounds/shot.mp3"),empty:eventtouch?"":new Audio("sounds/empty.mp3"),miss:eventtouch?"":new Audio("sounds/miss.mp3"),reload:eventtouch?"":new Audio("sounds/reload.mp3")},enemy:{head:eventtouch?"":new Audio("sounds/enemy_head_hit.mp3"),headKill:eventtouch?"":new Audio("sounds/enemy_head_kill.mp3"),body:eventtouch?"":new Audio("sounds/enemy_body.mp3")},misc:{background:eventtouch?"":new Audio("sounds/backgroundDining.mp3"),gameover:eventtouch?"":new Audio("sounds/death.mp3"),healing:eventtouch?"":new Audio("sounds/healing.mp3")}};var sounds=eventtouch?false:true;eventtouch?$(".audio").hide():$(".audio").show();sounds=false;var debug=false;var loopStatus=false;shotsFired=0,magazine=15,magazineMax=15,reloading=false;player={maxHealth:debug?1e9:7300,health:debug?1e9:7300,score:{total:0,kills:0},shots:{head:0,body:0,arm:0,leg:0,miss:0,total:0}};var backgroundHeight,backgroundWidth;var enemies=[],enemiesPosition=[{top:"80%",left:"10%",scale:"1"},{top:"50%",left:"40%",scale:"1"},{top:"30%",left:"60%",scale:"1"},{top:"40%",left:"5%",scale:"1"}],uid=0,enemyMaxCount=4,damageTable={damage:{head:600,body:150,arm:65,leg:80},score:{headKill:720,head:650,body:610,arm:415,leg:430},zombie:{health:400,multiplier:.67,scoreMulti:.8,head:400,body:120,arm:35,leg:60,attackTime:2e3,attackDamage:230},crimson:{health:700,scoreMulti:.95,head:500,body:140,arm:45,leg:70,attackTime:1500,attackDamage:330},hunter:{health:900,scoreMulti:1.2,head:600,body:150,arm:65,leg:80,attackTime:1650,attackDamage:430}};var gameover=false;var pause=false;var p=0;$(document).on("keydown",reloadEvent);$(document).on(eventstart,".target-area",function(e){if(e===undefined||pause==true)return;if($(e.target).hasClass("health-item")){healthItemEvent($(e.target));return}if(magazine<=0&&reloading==false){playAudio(trackListing.firearm.empty);reloadPrompt();return}else if(reloading==true){return}player.shots.total++;$(".shots .magazine")[0].style.left=+$(".shots .magazine")[0].style.left.replace("px","")+$(".bulletcount-bullet")[0].offsetWidth+"px";$(".firearm").addClass("fire");setTimeout(function(){$(".firearm").removeClass("fire")},65);if($(e.target).hasClass("head")){playAudio(trackListing.enemy.head)}else if(!$(e.target).hasClass("hitbox")){playAudio(trackListing.firearm.miss)}else{playAudio(trackListing.enemy.body)}playAudio(trackListing.firearm.shot);magazine--;if(magazine<=0)$(".firearm").addClass("empty");var t=document.querySelectorAll(".target-area")[0].offsetLeft;var n=document.querySelectorAll(".target-area")[0].offsetTop;var r=e.originalEvent.clientX;var i=e.originalEvent.clientY;r=eventtouch?e.originalEvent.targetTouches[0].clientX-t:e.originalEvent.pageX-t;i=eventtouch?e.originalEvent.targetTouches[0].clientY-n:e.originalEvent.pageY-n;var s=1-Math.floor((window.innerHeight-i)/window.innerHeight*100)/100;var o=Math.floor(Math.random()*(4-1+1))+1;var u=$('<div class="bullet-hole" style="top:'+i+"px; left:"+r+"px; transform:scale("+s+');"></div>');var a=$('<div class="blood-hole blood0'+o+'" style="top:'+i+"px; left:"+r+'px;"></div>');if($(e.target).hasClass("hitbox")){targetHit($(e.target));$(".target-area").prepend(a);if(eventtouch){setTimeout(function(){$(a).remove()},250)}else{$(a).fadeOut(1e3,function(){$(a).remove()})}}else if($(e.target).hasClass("health-item")){healthItemEvent($(e.target))}else{$(".target-area").prepend(u);player.shots.miss++;if(eventtouch){setTimeout(function(){$(u).remove()},250)}else{setTimeout(function(){$(u).fadeOut(1e3,function(){$(u).remove()})},1e3)}}});$(document).on(eventmove,".target-area",function(e){if(e===undefined)return;var t=document.querySelectorAll(".target-area")[0].offsetLeft;var n=e.originalEvent.clientX;var r=e.originalEvent.clientY;n=eventtouch?e.originalEvent.targetTouches[0].clientX-t:e.originalEvent.pageX-t;r=eventtouch?e.originalEvent.targetTouches[0].clientY:e.originalEvent.pageY;var i=1-Math.floor((window.innerHeight-r)/window.innerHeight*100)/100;var s=$(".target-area").outerWidth(true)/3;$(".firearm").attr("data-position","center");$(".firearm").css({left:n})});$(document).ready(function(){pageRatio();$(window).on("resize",pageRatio);$(document).on(eventstart,".restart",function(e){e.preventDefault();startGame()});$(document).on(eventstart,".reload-button",reloadEvent);for(var e=0;e<magazine;e++){$(".shots .magazine").append('<span class="bulletcount-bullet"></span>')}orientationChange();init();$(window).on("touchmove",function(e){e.preventDefault()});$(window).on("resize",backgroundRatio);$(window).on("resize",orientationChange);$(document).on("click",".audio",audioControls)});(function(){function e(e,t){var n=this;this.touch="ontouchstart"in document.documentElement?true:false,this.event={click:n.touch?"tap":"click",start:n.touch?"touchstart":"mousedown",end:n.touch?"touchend":"mouseup",move:n.touch?"touchmove":"mousemove"},this.target={touching:false,moving:false,starttouch:"",startX:"",startY:"",endtouch:"",endX:"",endY:""},this.variable={touching:false,currentPosition:"",pageCount:1},this.html={name:".slide",elem:$(e),page:$(e).find(".slide-page"),rail:$(e).find(".slide-rail")},this.defaults={current:0,delay:5e3,transition:500};this.options=$.extend({},n.defaults,t);this.init()}return;e.prototype={init:function(){var e=this;this.bindEvents()},bindEvents:function(){var e=this}};$.fn.residentClick=function(t){return this.each(function(){var n=new e(this,t)})}})()